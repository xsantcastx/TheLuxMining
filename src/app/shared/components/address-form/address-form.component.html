<div class="address-form-container">
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">
    
    <!-- Success/Error Messages -->
    <div *ngIf="success" class="alert alert-success bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
      {{ success }}
    </div>
    
    <div *ngIf="error" class="alert alert-error bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
      {{ error }}
    </div>

    <!-- Name Fields -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="firstName" class="form-label">
          First Name <span class="text-red-500">*</span>
        </label>
        <input
          id="firstName"
          type="text"
          formControlName="firstName"
          class="form-input"
          [class.border-red-500]="hasError('firstName')"
          placeholder="John"
        />
        <span *ngIf="hasError('firstName')" class="form-error">
          {{ getErrorMessage('firstName') }}
        </span>
      </div>

      <div>
        <label for="lastName" class="form-label">
          Last Name <span class="text-red-500">*</span>
        </label>
        <input
          id="lastName"
          type="text"
          formControlName="lastName"
          class="form-input"
          [class.border-red-500]="hasError('lastName')"
          placeholder="Doe"
        />
        <span *ngIf="hasError('lastName')" class="form-error">
          {{ getErrorMessage('lastName') }}
        </span>
      </div>
    </div>

    <!-- Company (Optional) -->
    <div>
      <label for="company" class="form-label">Company (Optional)</label>
      <input
        id="company"
        type="text"
        formControlName="company"
        class="form-input"
        placeholder="Company name"
      />
    </div>

    <!-- Address Line 1 -->
    <div>
      <label for="line1" class="form-label">
        Address Line 1 <span class="text-red-500">*</span>
      </label>
      <input
        id="line1"
        type="text"
        formControlName="line1"
        class="form-input"
        [class.border-red-500]="hasError('line1')"
        placeholder="123 Main Street"
      />
      <span *ngIf="hasError('line1')" class="form-error">
        {{ getErrorMessage('line1') }}
      </span>
    </div>

    <!-- Address Line 2, Unit, Buzzer -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label for="line2" class="form-label">Apt/Suite (Optional)</label>
        <input
          id="line2"
          type="text"
          formControlName="line2"
          class="form-input"
          placeholder="Apartment 4B"
        />
      </div>

      <div>
        <label for="unit" class="form-label">Unit # (Optional)</label>
        <input
          id="unit"
          type="text"
          formControlName="unit"
          class="form-input"
          placeholder="Unit 201"
        />
      </div>

      <div>
        <label for="buzzer" class="form-label">Buzzer Code (Optional)</label>
        <input
          id="buzzer"
          type="text"
          formControlName="buzzer"
          class="form-input"
          placeholder="1234"
        />
      </div>
    </div>

    <!-- City, State, Postal Code -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label for="city" class="form-label">
          City <span class="text-red-500">*</span>
        </label>
        <input
          id="city"
          type="text"
          formControlName="city"
          class="form-input"
          [class.border-red-500]="hasError('city')"
          placeholder="San Francisco"
        />
        <span *ngIf="hasError('city')" class="form-error">
          {{ getErrorMessage('city') }}
        </span>
      </div>

      <div>
        <label for="region" class="form-label">
          State <span class="text-red-500">*</span>
        </label>
        <select
          id="region"
          formControlName="region"
          class="form-input"
          [class.border-red-500]="hasError('region')"
        >
          <option value="">Select a state...</option>
          <option *ngFor="let state of usStates" [value]="state.code">
            {{ state.name }}
          </option>
        </select>
        <span *ngIf="hasError('region')" class="form-error">
          {{ getErrorMessage('region') }}
        </span>
      </div>

      <div>
        <label for="postalCode" class="form-label">
          ZIP Code <span class="text-red-500">*</span>
        </label>
        <input
          id="postalCode"
          type="text"
          formControlName="postalCode"
          class="form-input"
          [class.border-red-500]="hasError('postalCode')"
          placeholder="94102"
        />
        <span *ngIf="hasError('postalCode')" class="form-error">
          {{ getErrorMessage('postalCode') }}
        </span>
      </div>
    </div>

    <!-- Country (US Only) -->
    <div>
      <label for="country" class="form-label">
        Country <span class="text-red-500">*</span>
      </label>
      <select
        id="country"
        formControlName="country"
        class="form-input bg-gray-100 cursor-not-allowed"
        [class.border-red-500]="hasError('country')"
        [disabled]="true"
      >
        <option *ngFor="let country of countries" [value]="country.code">
          {{ country.name }}
        </option>
      </select>
      <span class="form-help text-xs text-gray-500">Currently shipping to US addresses only</span>
    </div>

    <!-- Phone and Email -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="phone" class="form-label">
          Phone Number <span class="text-red-500">*</span>
        </label>
        <div class="flex gap-2">
          <span class="inline-flex items-center px-3 py-2 bg-gray-100 border border-gray-300 rounded-l-xl text-gray-700 font-medium">
            {{ selectedCountryDialCode }}
          </span>
          <input
            id="phone"
            type="tel"
            formControlName="phone"
            class="form-input flex-1 rounded-l-none"
            [class.border-red-500]="hasError('phone') || phoneError"
            placeholder="4155551234"
          />
        </div>
        <span *ngIf="hasError('phone')" class="form-error">
          {{ getErrorMessage('phone') }}
        </span>
        <span *ngIf="phoneError && !hasError('phone')" class="form-error">
          {{ phoneError }}
        </span>
        <span class="form-help">Enter phone without country code</span>
      </div>

      <div>
        <label for="email" class="form-label">
          Email <span class="text-red-500">*</span>
        </label>
        <input
          id="email"
          type="email"
          formControlName="email"
          class="form-input"
          [class.border-red-500]="hasError('email')"
          placeholder="john@example.com"
        />
        <span *ngIf="hasError('email')" class="form-error">
          {{ getErrorMessage('email') }}
        </span>
      </div>
    </div>

    <!-- Delivery Notes -->
    <div>
      <label for="deliveryNotes" class="form-label">Delivery Instructions (Optional)</label>
      <textarea
        id="deliveryNotes"
        formControlName="deliveryNotes"
        class="form-input"
        rows="3"
        placeholder="Leave package at front desk, ring doorbell twice, etc."
      ></textarea>
    </div>

    <!-- Set as Default -->
    <div class="flex items-center">
      <input
        id="isDefault"
        type="checkbox"
        formControlName="isDefault"
        class="w-4 h-4 text-bitcoin-orange border-gray-300 rounded focus:ring-bitcoin-orange"
      />
      <label for="isDefault" class="ml-2 text-sm text-gray-700">
        Set as default shipping address
      </label>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-4 pt-4">
      <button
        type="submit"
        [disabled]="submitting || form.invalid"
        class="btn-primary flex-1 md:flex-none"
        [class.opacity-50]="submitting || form.invalid"
      >
        <span *ngIf="!submitting">{{ submitButtonText }}</span>
        <span *ngIf="submitting" class="flex items-center justify-center gap-2">
          <svg class="animate-spin h-5 w-5" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Saving...
        </span>
      </button>

      <button
        type="button"
        (click)="onCancel()"
        class="btn-secondary"
        [disabled]="submitting"
      >
        Cancel
      </button>
    </div>
  </form>
</div>
