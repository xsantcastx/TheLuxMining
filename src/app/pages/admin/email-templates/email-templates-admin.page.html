<div class="admin-page">
  <app-admin-quick-actions />
  
  <div class="admin-content">
    <div class="page-header">
      <h1>{{ 'ADMIN.TEMPLATES.TITLE' | translate }}</h1>
      <button class="btn-primary" (click)="addNew()">
        <i class="bi bi-plus-lg"></i> Add Template
      </button>
    </div>

    <div *ngIf="message" class="message" [ngClass]="{
      'message-success': messageType === 'success',
      'message-error': messageType === 'error',
      'message-info': messageType === 'info'
    }">
      {{ message }}
    </div>

    <div *ngIf="isLoading" class="loading-container">
      <div class="spinner"></div>
      <p>Loading templates...</p>
    </div>

    <div *ngIf="!isLoading && templates.length === 0" class="empty-state">
      <i class="bi bi-file-earmark-text"></i>
      <p>No templates yet. Create your first template!</p>
    </div>

    <div *ngIf="!isLoading && templates.length > 0" class="data-table">
      <table>
        <thead>
          <tr>
            <th>Type</th>
            <th>Scope</th>
            <th>Language</th>
            <th>Content Preview</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let template of templates">
            <td><span class="badge badge-info">{{ getTypeLabel(template.type) }}</span></td>
            <td><span class="badge badge-secondary">{{ getScopeLabel(template.scope) }}</span></td>
            <td>{{ template.language.toUpperCase() }}</td>
            <td class="truncate">{{ template.content || 'No content' }}</td>
            <td>
              <span class="badge" [class.badge-success]="template.active" [class.badge-danger]="!template.active">
                {{ template.active ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td class="actions">
              <button class="btn-sm btn-edit" (click)="edit(template)" title="Edit">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn-sm btn-delete" (click)="delete(template)" title="Delete">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Edit Template' : 'Add Template' }}</h2>
      <button class="btn-close" (click)="closeModal()">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Type *</label>
          <select [(ngModel)]="selectedTemplate.type" class="form-select">
            <option *ngFor="let type of templateTypes" [value]="type">{{ getTypeLabel(type) }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Scope *</label>
          <select [(ngModel)]="selectedTemplate.scope" class="form-select">
            <option *ngFor="let scope of templateScopes" [value]="scope">{{ getScopeLabel(scope) }}</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Language *</label>
          <select [(ngModel)]="selectedTemplate.language" class="form-select">
            <option *ngFor="let lang of languages" [value]="lang">{{ lang.toUpperCase() }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Reference ID (optional)</label>
          <input type="text" [(ngModel)]="selectedTemplate.refId" placeholder="Model/Category/Tag ID">
        </div>
      </div>

      <div class="form-group">
        <label>Content *</label>
        <textarea [(ngModel)]="selectedTemplate.content" rows="8" placeholder="Template content with placeholders like {{'{name}'}}..."></textarea>
        <small class="form-hint">Use placeholders: {{ '{' }}name{{ '}' }}, {{ '{' }}model{{ '}' }}, {{ '{' }}category{{ '}' }}, {{ '{' }}size{{ '}' }}, {{ '{' }}finish{{ '}' }}, {{ '{' }}color{{ '}' }}</small>
      </div>

      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" [(ngModel)]="selectedTemplate.active">
          Active
        </label>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeModal()">Cancel</button>
      <button class="btn-primary" (click)="save()">
        {{ isEditMode ? 'Update' : 'Create' }}
      </button>
    </div>
  </div>
</div>
