<div class="min-h-screen bg-ts-bg">
  <div class="bg-gradient-to-r from-ts-bg via-gray-900 to-ts-bg border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h1 class="text-3xl font-bold bitcoin-gradient-text mb-2">{{ 'admin.models.title' | translate }}</h1>
          <p class="text-white/70">{{ 'admin.models.subtitle' | translate }}</p>
        </div>
        <button
          (click)="addNew()"
          class="inline-flex items-center justify-center gap-2 px-6 py-3 bg-bitcoin-orange text-white rounded-xl font-semibold hover:bg-bitcoin-orange/90 transition-all">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg>
          <span>{{ 'admin.models.actions.add' | translate }}</span>
        </button>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6">
    <app-admin-quick-actions [currentPage]="'/admin/models'"></app-admin-quick-actions>

    @if (messageKey) {
      <div
        class="p-4 rounded-xl border"
        [class.bg-green-500/10]="messageType === 'success'"
        [class.border-green-500/30]="messageType === 'success'"
        [class.text-green-400]="messageType === 'success'"
        [class.bg-red-500/10]="messageType === 'error'"
        [class.border-red-500/30]="messageType === 'error'"
        [class.text-red-400]="messageType === 'error'"
        [class.bg-bitcoin-orange/10]="messageType === 'info'"
        [class.border-bitcoin-orange/20]="messageType === 'info'"
        [class.text-bitcoin-orange]="messageType === 'info'">
        {{ messageKey | translate: messageParams }}
      </div>
    }
    @if (errorMessage) {
      <div class="p-4 rounded-xl border border-red-500/30 bg-red-500/10 text-red-300">
        {{ errorMessage }}
      </div>
    }

    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div class="relative flex-1 max-w-md">
        <svg class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M9.5 17a7.5 7.5 0 110-15 7.5 7.5 0 010 15z"></path>
        </svg>
        <input
          type="search"
          [(ngModel)]="filterTerm"
          class="w-full pl-9 pr-4 py-2.5 bg-gray-900/60 border border-white/10 rounded-lg text-white placeholder:text-white/60 focus:border-bitcoin-orange focus:ring-1 focus:ring-bitcoin-orange transition-all"
          [placeholder]="'admin.models.filters.search_placeholder' | translate">
      </div>
      <div class="flex items-center gap-3">
        <label class="text-sm text-white/70">{{ 'admin.models.filters.status_label' | translate }}</label>
        <select
          [(ngModel)]="statusFilter"
          class="bg-gray-900/60 border border-white/10 rounded-lg text-white px-3 py-2 focus:border-bitcoin-orange focus:ring-1 focus:ring-bitcoin-orange">
          <option value="all">{{ 'admin.models.filters.status_all' | translate }}</option>
          <option value="active">{{ 'admin.models.filters.status_active' | translate }}</option>
          <option value="inactive">{{ 'admin.models.filters.status_inactive' | translate }}</option>
        </select>
      </div>
    </div>

    @if (isLoading) {
      <div class="flex flex-col items-center justify-center py-16 gap-4 bg-gray-900/40 border border-white/10 rounded-2xl">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-bitcoin-orange border-t-transparent"></div>
        <p class="text-white/70">{{ 'common.loading' | translate }}</p>
      </div>
    } @else if (filteredModels.length === 0) {
      <div class="bg-gray-900/40 border border-white/10 rounded-2xl p-12 text-center">
        <p class="text-white/70 mb-4">{{ 'admin.models.empty' | translate }}</p>
        <button (click)="addNew()" class="px-6 py-3 bg-bitcoin-orange text-white rounded-xl hover:bg-bitcoin-orange/90 transition-all">
          {{ 'admin.models.actions.create_first' | translate }}
        </button>
      </div>
    } @else {
      <div class="bg-gray-900/40 border border-white/10 rounded-2xl overflow-hidden">
        <table class="w-full text-left">
          <thead class="bg-gray-900/60 text-xs uppercase tracking-wide text-white/60">
            <tr>
              <th class="px-6 py-4">{{ 'admin.models.table.name' | translate }}</th>
              <th class="px-6 py-4">{{ 'admin.models.table.slug' | translate }}</th>
              <th class="px-6 py-4">{{ 'admin.models.table.category' | translate }}</th>
              <th class="px-6 py-4">{{ 'admin.models.table.status' | translate }}</th>
              <th class="px-6 py-4 text-right">{{ 'admin.models.table.actions' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            @for (model of filteredModels; track trackByModelId($index, model)) {
              <tr class="border-t border-white/5 hover:bg-gray-900/50 transition-colors">
                <td class="px-6 py-4 text-white font-medium">
                  <div class="flex flex-col gap-1">
                    <span>{{ model.name }}</span>
                    @if (model.textureHints && model.textureHints.length) {
                    <span class="text-xs text-white/60">{{ model.textureHints.join(', ') }}</span>
                    }
                  </div>
                </td>
                <td class="px-6 py-4 text-bitcoin-orange font-mono text-sm">{{ model.slug }}</td>
                <td class="px-6 py-4 text-white/70">
                  {{ getCategoryName(model.categoryId) }}
                </td>
                <td class="px-6 py-4">
                  @if (model.active !== false) {
                    <span class="px-3 py-1 text-xs font-semibold bg-green-500/20 text-green-400 rounded-full border border-green-500/30">
                      {{ 'admin.models.table.active' | translate }}
                    </span>
                  } @else {
                    <span class="px-3 py-1 text-xs font-semibold bg-red-500/20 text-red-400 rounded-full border border-red-500/30">
                      {{ 'admin.models.table.inactive' | translate }}
                    </span>
                  }
                </td>
                <td class="px-6 py-4 text-right">
                  <div class="flex items-center justify-end gap-2">
                    <button
                      (click)="edit(model)"
                      class="px-3 py-1.5 text-xs bg-bitcoin-orange/20 border border-bitcoin-orange/30 text-bitcoin-orange rounded-lg hover:bg-bitcoin-orange/30 transition-all">
                      {{ 'admin.models.actions.edit' | translate }}
                    </button>
                    <button
                      (click)="delete(model)"
                      class="px-3 py-1.5 text-xs bg-red-500/20 border border-red-500/30 text-red-400 rounded-lg hover:bg-red-500/30 transition-all">
                      {{ 'admin.models.actions.delete' | translate }}
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }


  </div>

  @if (showModal) {
    <div class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4">
      <div class="bg-gray-900 rounded-2xl border border-white/10 max-w-2xl w-full overflow-hidden">
        <div class="flex items-center justify-between px-6 py-4 border-b border-white/10">
          <h2 class="text-2xl font-semibold text-white">
            {{ (isEditMode ? 'admin.models.modal.edit_title' : 'admin.models.modal.new_title') | translate }}
          </h2>
          <button (click)="closeModal()" class="text-white/70 hover:text-white transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <div class="px-6 py-6 space-y-5">
          <div class="space-y-2">
            <label class="text-sm font-medium text-white/70">{{ 'admin.models.fields.name' | translate }}</label>
            <input
              type="text"
              [(ngModel)]="selectedModel.name"
              (blur)="generateSlug()"
              class="w-full px-4 py-2.5 bg-gray-900/60 border border-white/10 rounded-lg text-white focus:border-bitcoin-orange focus:ring-1 focus:ring-bitcoin-orange"
              [placeholder]="'admin.models.fields.name_placeholder' | translate">
          </div>

          <div class="space-y-2">
            <label class="text-sm font-medium text-white/70">{{ 'admin.models.fields.slug' | translate }}</label>
            <input
              type="text"
              [(ngModel)]="selectedModel.slug"
              class="w-full px-4 py-2.5 bg-gray-900/60 border border-white/10 rounded-lg text-bitcoin-orange font-mono focus:border-bitcoin-orange focus:ring-1 focus:ring-bitcoin-orange">
            <p class="text-xs text-white/60">{{ 'admin.models.fields.slug_help' | translate }}</p>
          </div>

          <div class="space-y-2">
            <label class="text-sm font-medium text-white/70">{{ 'admin.models.fields.category' | translate }}</label>
            <select
              [(ngModel)]="selectedModel.categoryId"
              class="w-full px-4 py-2.5 bg-gray-900/60 border border-white/10 rounded-lg text-white focus:border-bitcoin-orange focus:ring-1 focus:ring-bitcoin-orange">
              @for (category of categories; track category.id) {
                <option [value]="category.id">{{ category.name }}</option>
              }
            </select>
          </div>

          <div class="space-y-2">
            <label class="text-sm font-medium text-white/70">{{ 'admin.models.fields.texture_hints' | translate }}</label>
            <textarea
              [(ngModel)]="textureHintsInput"
              rows="3"
              class="w-full px-4 py-2.5 bg-gray-900/60 border border-white/10 rounded-lg text-white focus:border-bitcoin-orange focus:ring-1 focus:ring-bitcoin-orange"
              [placeholder]="'admin.models.fields.texture_hints_placeholder' | translate"></textarea>
            <p class="text-xs text-white/60">{{ 'admin.models.fields.texture_hints_help' | translate }}</p>
          </div>

          <div class="space-y-2">
            <label class="text-sm font-medium text-white/70">{{ 'admin.models.fields.default_tags' | translate }}</label>
            <textarea
              [(ngModel)]="defaultTagsInput"
              rows="2"
              class="w-full px-4 py-2.5 bg-gray-900/60 border border-white/10 rounded-lg text-white focus:border-bitcoin-orange focus:ring-1 focus:ring-bitcoin-orange"
              [placeholder]="'admin.models.fields.default_tags_placeholder' | translate"></textarea>
            <p class="text-xs text-white/60">{{ 'admin.models.fields.default_tags_help' | translate }}</p>
          </div>

          <label class="flex items-center gap-2 text-white cursor-pointer">
            <input type="checkbox" [(ngModel)]="selectedModel.active" class="w-4 h-4 text-bitcoin-orange bg-gray-900 border-white/10 rounded focus:ring-bitcoin-orange">
            <span>{{ 'admin.models.fields.active' | translate }}</span>
          </label>
        </div>

        <div class="px-6 py-4 border-t border-white/10 flex items-center justify-end gap-3">
          <button (click)="closeModal()" class="px-6 py-2.5 border border-white/10 text-white/70 rounded-xl hover:bg-white/5 transition-all">
            {{ 'admin.models.actions.cancel' | translate }}
          </button>
          <button (click)="save()" class="px-6 py-2.5 bg-bitcoin-orange text-white rounded-xl hover:bg-bitcoin-orange/90 transition-all">
            {{ (isEditMode ? 'admin.models.actions.update' : 'admin.models.actions.create') | translate }}
          </button>
        </div>
      </div>
    </div>
  }
</div>
