<!-- Setup Guide Admin Management -->
<div class="min-h-screen bg-gradient-to-b from-[#0a0b0d] to-[#13151a] py-8">
  <div class="page-container max-w-6xl">
    
    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
      <div>
        <h1 class="text-4xl font-bold text-white mb-2">Setup Guide Management</h1>
        <p class="text-bitcoin-gray">Manage the setup guide content, video, images, and steps</p>
      </div>
      <div class="flex items-center gap-3">
        <a routerLink="/setup-guide" target="_blank"
           class="inline-flex items-center gap-2 px-4 py-2 bg-bitcoin-dark/60 text-white border border-bitcoin-gray/20 rounded-lg hover:border-bitcoin-orange/50 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
          </svg>
          Preview
        </a>
        <button 
          (click)="saveGuide()"
          [disabled]="isSaving"
          class="inline-flex items-center gap-2 px-6 py-2 bg-bitcoin-orange text-bitcoin-dark rounded-lg font-semibold hover:bg-bitcoin-gold transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          @if (isSaving) {
            <svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Saving...
          } @else {
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            Save Changes
          }
        </button>
      </div>
    </div>

    @if (isLoading) {
      <div class="flex justify-center items-center py-20">
        <div class="app-spinner" style="--spinner-size: 64px;">
          <img src="/Logo Clear.png" alt="" width="80" height="80">
        </div>
      </div>
    } @else if (setupGuide) {
      <form #guideForm="ngForm">
        
        <!-- Publish Toggle -->
        <div class="bg-bitcoin-dark/40 backdrop-blur-md border border-bitcoin-orange/20 rounded-2xl p-6 mb-6 shadow-bitcoin">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-xl font-bold text-white mb-1">Publish Status</h3>
              <p class="text-bitcoin-gray text-sm">Make this guide visible to the public</p>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input 
                type="checkbox" 
                [(ngModel)]="setupGuide.isPublished"
                name="isPublished"
                class="sr-only peer">
              <div class="w-14 h-7 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-bitcoin-orange/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-bitcoin-orange"></div>
            </label>
          </div>
        </div>

        <!-- Basic Information -->
        <div class="bg-bitcoin-dark/40 backdrop-blur-md border border-bitcoin-orange/20 rounded-2xl p-6 mb-6 shadow-bitcoin">
          <h2 class="text-2xl font-bold text-white mb-6">Basic Information</h2>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Title *
              </label>
              <input 
                type="text"
                [(ngModel)]="setupGuide.title"
                name="title"
                required
                placeholder="e.g., Solo Miner Setup Guide"
                class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Subtitle
              </label>
              <input 
                type="text"
                [(ngModel)]="setupGuide.subtitle"
                name="subtitle"
                placeholder="e.g., Get your miner up and running in minutes"
                class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Hero Image
              </label>
              @if (setupGuide.heroImageUrl) {
                <div class="mb-3 relative group">
                  <img [src]="setupGuide.heroImageUrl" alt="Hero Image" class="w-full h-48 object-cover rounded-lg border-2 border-bitcoin-gray/20">
                  <div class="absolute top-2 right-2 flex gap-2">
                    <button
                      type="button"
                      (click)="openMediaSelectorForHeroImage()"
                      class="px-3 py-2 bg-bitcoin-orange/90 text-white rounded-lg text-sm font-medium hover:bg-bitcoin-orange transition-colors">
                      Change
                    </button>
                    <button
                      type="button"
                      (click)="clearHeroImage()"
                      class="px-3 py-2 bg-red-600/90 text-white rounded-lg text-sm font-medium hover:bg-red-600 transition-colors">
                      Remove
                    </button>
                  </div>
                </div>
              } @else {
                <!-- Upload Progress -->
                @if (isUploadingHeroImage) {
                  <div class="w-full px-4 py-8 bg-bitcoin-dark/60 border-2 border-bitcoin-orange/50 rounded-lg">
                    <div class="flex flex-col items-center">
                      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-bitcoin-orange mb-4"></div>
                      <p class="text-bitcoin-orange font-medium mb-2">{{ heroImageUploadStatus }}</p>
                      <div class="w-full max-w-md bg-bitcoin-gray/20 rounded-full h-2 overflow-hidden">
                        <div 
                          class="bg-bitcoin-orange h-full transition-all duration-300"
                          [style.width.%]="heroImageUploadProgress">
                        </div>
                      </div>
                      <p class="text-bitcoin-gray text-sm mt-2">{{ heroImageUploadProgress }}%</p>
                    </div>
                  </div>
                } @else {
                  <div class="flex gap-3">
                    <!-- Upload from Device Button -->
                    <label class="flex-1 flex flex-col items-center justify-center px-4 py-8 bg-bitcoin-dark/60 border-2 border-dashed border-bitcoin-gray/30 text-bitcoin-gray rounded-lg hover:border-bitcoin-orange/50 hover:bg-bitcoin-dark/80 transition-colors cursor-pointer">
                      <svg class="h-12 w-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                      </svg>
                      <span class="font-medium">Upload from Device</span>
                      <span class="text-xs mt-1">JPG, PNG, WebP (max 5MB)</span>
                      <input 
                        type="file" 
                        accept="image/jpeg,image/jpg,image/png,image/webp"
                        (change)="onHeroImageSelected($event)"
                        class="hidden">
                    </label>

                    <!-- Select from Library Button -->
                    <button
                      type="button"
                      (click)="openMediaSelectorForHeroImage()"
                      class="flex-1 flex flex-col items-center justify-center px-4 py-8 bg-bitcoin-dark/60 border-2 border-dashed border-bitcoin-gray/30 text-bitcoin-gray rounded-lg hover:border-bitcoin-orange/50 hover:bg-bitcoin-dark/80 transition-colors">
                      <svg class="h-12 w-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                      </svg>
                      <span class="font-medium">Select from Library</span>
                      <span class="text-xs mt-1">Choose existing image</span>
                    </button>
                  </div>
                }
              }
              <p class="text-xs text-bitcoin-gray mt-2">Optional background image for the hero section - upload from device or library</p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Introduction Text
              </label>
              <textarea 
                [(ngModel)]="setupGuide.introduction"
                name="introduction"
                rows="4"
                placeholder="Welcome message and overview..."
                class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange"></textarea>
            </div>
          </div>
        </div>

        <!-- Video Section -->
        <div class="bg-bitcoin-dark/40 backdrop-blur-md border border-bitcoin-orange/20 rounded-2xl p-6 mb-6 shadow-bitcoin">
          <h2 class="text-2xl font-bold text-white mb-6">Setup Video</h2>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Video
              </label>
              @if (setupGuide.videoUrl) {
                <div class="mb-3 relative group">
                  @if (setupGuide.videoUrl.includes('youtube') || setupGuide.videoUrl.includes('youtu.be')) {
                    <div class="aspect-video bg-black rounded-lg overflow-hidden">
                      <iframe
                        [src]="setupGuide.videoUrl"
                        class="w-full h-full"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                      </iframe>
                    </div>
                  } @else {
                    <video [src]="setupGuide.videoUrl" controls class="w-full rounded-lg border-2 border-bitcoin-gray/20"></video>
                  }
                  <div class="absolute top-2 right-2 flex gap-2">
                    <button
                      type="button"
                      (click)="openMediaSelectorForVideo()"
                      class="px-3 py-2 bg-bitcoin-orange/90 text-white rounded-lg text-sm font-medium hover:bg-bitcoin-orange transition-colors">
                      Change Video
                    </button>
                    <button
                      type="button"
                      (click)="clearVideo()"
                      class="px-3 py-2 bg-red-600/90 text-white rounded-lg text-sm font-medium hover:bg-red-600 transition-colors">
                      Remove
                    </button>
                  </div>
                </div>
                <p class="text-xs text-bitcoin-gray">Current: {{ setupGuide.videoUrl }}</p>
              } @else {
                <!-- Upload Progress -->
                @if (isUploadingVideo) {
                  <div class="w-full px-4 py-8 bg-bitcoin-dark/60 border-2 border-bitcoin-orange/50 rounded-lg">
                    <div class="flex flex-col items-center">
                      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-bitcoin-orange mb-4"></div>
                      <p class="text-bitcoin-orange font-medium mb-2">{{ videoUploadStatus }}</p>
                      <div class="w-full max-w-md bg-bitcoin-gray/20 rounded-full h-2 overflow-hidden">
                        <div 
                          class="bg-bitcoin-orange h-full transition-all duration-300"
                          [style.width.%]="videoUploadProgress">
                        </div>
                      </div>
                      <p class="text-bitcoin-gray text-sm mt-2">{{ videoUploadProgress }}%</p>
                    </div>
                  </div>
                } @else {
                  <div class="flex gap-3">
                    <!-- Upload from Device Button -->
                    <label class="flex-1 flex flex-col items-center justify-center px-4 py-8 bg-bitcoin-dark/60 border-2 border-dashed border-bitcoin-gray/30 text-bitcoin-gray rounded-lg hover:border-bitcoin-orange/50 hover:bg-bitcoin-dark/80 transition-colors cursor-pointer">
                      <svg class="h-12 w-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                      </svg>
                      <span class="font-medium">Upload Video from Device</span>
                      <span class="text-xs mt-1">MP4, WebM (max 50MB, 60s)</span>
                      <input 
                        type="file" 
                        accept="video/mp4,video/webm,video/ogg"
                        (change)="onVideoSelected($event)"
                        class="hidden">
                    </label>

                    <!-- Select from Library Button -->
                    <button
                      type="button"
                      (click)="openMediaSelectorForVideo()"
                      class="flex-1 flex flex-col items-center justify-center px-4 py-8 bg-bitcoin-dark/60 border-2 border-dashed border-bitcoin-gray/30 text-bitcoin-gray rounded-lg hover:border-bitcoin-orange/50 hover:bg-bitcoin-dark/80 transition-colors">
                      <svg class="h-12 w-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                      </svg>
                      <span class="font-medium">Select from Library</span>
                      <span class="text-xs mt-1">Choose existing video</span>
                    </button>
                  </div>
                }
              }
              <p class="text-xs text-bitcoin-gray mt-2">Supports YouTube URLs, direct video links, and device uploads</p>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Video Thumbnail URL (Optional)
              </label>
              <input 
                type="url"
                [(ngModel)]="setupGuide.videoThumbnailUrl"
                name="videoThumbnailUrl"
                placeholder="https://..."
                class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange">
              <p class="text-xs text-bitcoin-gray mt-1">Only for direct video files, not YouTube</p>
            </div>
          </div>
        </div>

        <!-- Requirements Section -->
        <div class="bg-bitcoin-dark/40 backdrop-blur-md border border-bitcoin-orange/20 rounded-2xl p-6 mb-6 shadow-bitcoin">
          <h2 class="text-2xl font-bold text-white mb-6">Requirements</h2>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Section Title
              </label>
              <input 
                type="text"
                [(ngModel)]="setupGuide.requirementsTitle"
                name="requirementsTitle"
                placeholder="e.g., What You'll Need"
                class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Requirements List
              </label>
              <div class="space-y-2">
                @for (requirement of setupGuide.requirements || []; track $index) {
                  <div class="flex items-center gap-2">
                    <input 
                      type="text"
                      [(ngModel)]="setupGuide.requirements![$index]"
                      [name]="'requirement_' + $index"
                      placeholder="Enter requirement..."
                      class="flex-1 px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange">
                    <button 
                      type="button"
                      (click)="removeRequirement($index)"
                      class="p-2 text-red-400 hover:bg-red-400/10 rounded-lg transition-colors">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                      </svg>
                    </button>
                  </div>
                }
              </div>
              <button 
                type="button"
                (click)="addRequirement()"
                class="mt-3 inline-flex items-center gap-2 px-4 py-2 bg-bitcoin-orange/20 text-bitcoin-orange border border-bitcoin-orange/30 rounded-lg hover:bg-bitcoin-orange/30 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Add Requirement
              </button>
            </div>
          </div>
        </div>

        <!-- Setup Steps -->
        <div class="bg-bitcoin-dark/40 backdrop-blur-md border border-bitcoin-orange/20 rounded-2xl p-6 mb-6 shadow-bitcoin">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-white">Setup Steps</h2>
            <button 
              type="button"
              (click)="addStep()"
              class="inline-flex items-center gap-2 px-4 py-2 bg-bitcoin-orange text-bitcoin-dark rounded-lg font-semibold hover:bg-bitcoin-gold transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              Add Step
            </button>
          </div>

          <div class="space-y-4">
            @for (step of setupGuide.steps || []; track step.id) {
              <div class="bg-bitcoin-dark/60 border border-bitcoin-gray/20 rounded-xl p-4">
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg bg-bitcoin-orange/20 flex items-center justify-center">
                      <span class="text-lg font-bold text-bitcoin-orange">{{ step.order }}</span>
                    </div>
                    <span class="text-white font-semibold">Step {{ step.order }}</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <button 
                      type="button"
                      (click)="moveStepUp(step)"
                      [disabled]="step.order === 1"
                      class="p-2 text-bitcoin-gray hover:text-bitcoin-orange disabled:opacity-30 disabled:cursor-not-allowed">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                      </svg>
                    </button>
                    <button 
                      type="button"
                      (click)="moveStepDown(step)"
                      [disabled]="step.order === setupGuide.steps.length"
                      class="p-2 text-bitcoin-gray hover:text-bitcoin-orange disabled:opacity-30 disabled:cursor-not-allowed">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                      </svg>
                    </button>
                    <button 
                      type="button"
                      (click)="removeStep(step.id)"
                      class="p-2 text-red-400 hover:bg-red-400/10 rounded-lg">
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                      </svg>
                    </button>
                  </div>
                </div>

                <div class="space-y-3">
                  <input 
                    type="text"
                    [(ngModel)]="step.title"
                    [name]="'step_title_' + step.id"
                    placeholder="Step title..."
                    class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange">
                  
                  <textarea 
                    [(ngModel)]="step.description"
                    [name]="'step_description_' + step.id"
                    rows="3"
                    placeholder="Step description..."
                    class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange"></textarea>
                  
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Step Image (Optional)</label>
                    @if (step.imageUrl) {
                      <div class="relative group">
                        <img [src]="step.imageUrl" alt="Step Image" class="w-full h-48 object-cover rounded-lg border-2 border-bitcoin-gray/20">
                        <div class="absolute top-2 right-2 flex gap-2">
                          <button
                            type="button"
                            (click)="openMediaSelectorForStepImage(step.id)"
                            class="px-3 py-2 bg-bitcoin-orange/90 text-white rounded-lg text-sm font-medium hover:bg-bitcoin-orange transition-colors">
                            Change
                          </button>
                          <button
                            type="button"
                            (click)="clearStepImage(step.id)"
                            class="px-3 py-2 bg-red-600/90 text-white rounded-lg text-sm font-medium hover:bg-red-600 transition-colors">
                            Remove
                          </button>
                        </div>
                      </div>
                    } @else {
                      <!-- Upload Progress -->
                      @if (uploadingStepImageId === step.id) {
                        <div class="w-full px-4 py-6 bg-bitcoin-dark/60 border-2 border-bitcoin-orange/50 rounded-lg">
                          <div class="flex flex-col items-center">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-bitcoin-orange mb-2"></div>
                            <p class="text-bitcoin-orange text-sm font-medium mb-2">{{ stepImageUploadStatus }}</p>
                            <div class="w-full bg-bitcoin-gray/20 rounded-full h-2 overflow-hidden">
                              <div 
                                class="bg-bitcoin-orange h-full transition-all duration-300"
                                [style.width.%]="stepImageUploadProgress">
                              </div>
                            </div>
                            <p class="text-bitcoin-gray text-xs mt-1">{{ stepImageUploadProgress }}%</p>
                          </div>
                        </div>
                      } @else {
                        <div class="flex gap-2">
                          <!-- Upload from Device Button -->
                          <label class="flex-1 flex flex-col items-center justify-center px-3 py-6 bg-bitcoin-dark/60 border-2 border-dashed border-bitcoin-gray/30 text-bitcoin-gray rounded-lg hover:border-bitcoin-orange/50 hover:bg-bitcoin-dark/80 transition-colors cursor-pointer">
                            <svg class="h-8 w-8 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                            </svg>
                            <span class="text-sm font-medium">Upload</span>
                            <input 
                              type="file" 
                              accept="image/jpeg,image/jpg,image/png,image/webp"
                              (change)="onStepImageSelected($event, step.id)"
                              class="hidden">
                          </label>

                          <!-- Select from Library Button -->
                          <button
                            type="button"
                            (click)="openMediaSelectorForStepImage(step.id)"
                            class="flex-1 flex flex-col items-center justify-center px-3 py-6 bg-bitcoin-dark/60 border-2 border-dashed border-bitcoin-gray/30 text-bitcoin-gray rounded-lg hover:border-bitcoin-orange/50 hover:bg-bitcoin-dark/80 transition-colors">
                            <svg class="h-8 w-8 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <span class="text-sm font-medium">Library</span>
                          </button>
                        </div>
                      }
                    }
                  </div>
                </div>
              </div>
            }

            @if (setupGuide.steps.length === 0) {
              <div class="text-center py-12">
                <svg class="w-16 h-16 mx-auto text-bitcoin-gray/40 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <p class="text-bitcoin-gray">No steps added yet. Click "Add Step" to get started.</p>
              </div>
            }
          </div>
        </div>

        <!-- FAQs Section -->
        <div class="bg-bitcoin-dark/40 backdrop-blur-md border border-bitcoin-orange/20 rounded-2xl p-6 mb-6 shadow-bitcoin">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-2xl font-bold text-white mb-2">FAQs</h2>
              <input 
                type="text"
                [(ngModel)]="setupGuide.faqTitle"
                name="faqTitle"
                placeholder="e.g., Frequently Asked Questions"
                class="w-64 px-4 py-2 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange">
            </div>
            <button 
              type="button"
              (click)="addFaq()"
              class="inline-flex items-center gap-2 px-4 py-2 bg-bitcoin-orange text-bitcoin-dark rounded-lg font-semibold hover:bg-bitcoin-gold transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              Add FAQ
            </button>
          </div>

          <div class="space-y-4">
            @for (faq of setupGuide.faqs || []; track $index) {
              <div class="bg-bitcoin-dark/60 border border-bitcoin-gray/20 rounded-xl p-4">
                <div class="flex items-start justify-between gap-4 mb-3">
                  <input 
                    type="text"
                    [(ngModel)]="faq.question"
                    [name]="'faq_question_' + $index"
                    placeholder="Question..."
                    class="flex-1 px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange">
                  <button 
                    type="button"
                    (click)="removeFaq($index)"
                    class="p-2 text-red-400 hover:bg-red-400/10 rounded-lg flex-shrink-0">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                  </button>
                </div>
                <textarea 
                  [(ngModel)]="faq.answer"
                  [name]="'faq_answer_' + $index"
                  rows="3"
                  placeholder="Answer..."
                  class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange"></textarea>
              </div>
            }

            @if (setupGuide.faqs?.length === 0) {
              <div class="text-center py-8">
                <p class="text-bitcoin-gray">No FAQs added yet.</p>
              </div>
            }
          </div>
        </div>

        <!-- Support Contact -->
        <div class="bg-bitcoin-dark/40 backdrop-blur-md border border-bitcoin-orange/20 rounded-2xl p-6 shadow-bitcoin">
          <h2 class="text-2xl font-bold text-white mb-6">Support Contact</h2>
          
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Support Email
              </label>
              <input 
                type="email"
                [(ngModel)]="setupGuide.supportContactEmail"
                name="supportEmail"
                placeholder="support@example.com"
                class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Support Phone
              </label>
              <input 
                type="tel"
                [(ngModel)]="setupGuide.supportContactPhone"
                name="supportPhone"
                placeholder="+1 (555) 123-4567"
                class="w-full px-4 py-2.5 bg-bitcoin-dark/60 border border-bitcoin-gray/20 text-white rounded-lg focus:ring-2 focus:ring-bitcoin-orange focus:border-bitcoin-orange">
            </div>
          </div>
        </div>

      </form>
    }

  </div>
</div>

<!-- Media Selector Modal -->
<app-media-selector-modal
  [isOpen]="isMediaSelectorOpen"
  [selectionMode]="'single'"
  [mediaType]="mediaSelectionTarget === 'video' ? 'video' : 'image'"
  [title]="mediaSelectionTarget === 'video' ? 'Select Video' : 'Select Image'"
  (mediaSelected)="onMediaSelected($event)"
  (close)="closeMediaSelector()">
</app-media-selector-modal>
